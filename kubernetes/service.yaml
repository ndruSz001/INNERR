# Kubernetes Service Manifests for TARS
# Exposes backend API and WebSocket endpoints

apiVersion: v1
kind: Service
metadata:
  name: tars-backend
  namespace: tars
  labels:
    app: tars
    component: backend
  annotations:
    description: "TARS Backend API Service"
spec:
  type: LoadBalancer
  selector:
    app: tars
    component: backend
  ports:
    - name: http
      protocol: TCP
      port: 8000
      targetPort: 8000
    - name: websocket
      protocol: TCP
      port: 8001
      targetPort: 8001
    - name: metrics
      protocol: TCP
      port: 9090
      targetPort: 9090
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 10800

---
# Headless Service for StatefulSet (if needed)
apiVersion: v1
kind: Service
metadata:
  name: tars-backend-headless
  namespace: tars
  labels:
    app: tars
    component: backend
spec:
  type: ClusterIP
  clusterIP: None
  selector:
    app: tars
    component: backend
  ports:
    - name: http
      protocol: TCP
      port: 8000
      targetPort: 8000

---
# PostgreSQL Service
apiVersion: v1
kind: Service
metadata:
  name: tars-postgres
  namespace: tars
  labels:
    app: tars
    component: database
spec:
  type: ClusterIP
  selector:
    app: tars
    component: postgres
  ports:
    - name: postgres
      protocol: TCP
      port: 5432
      targetPort: 5432

---
# Redis Service
apiVersion: v1
kind: Service
metadata:
  name: tars-redis
  namespace: tars
  labels:
    app: tars
    component: cache
spec:
  type: ClusterIP
  selector:
    app: tars
    component: redis
  ports:
    - name: redis
      protocol: TCP
      port: 6379
      targetPort: 6379

---
# Internal API Service (ClusterIP only - no external access)
apiVersion: v1
kind: Service
metadata:
  name: tars-api-internal
  namespace: tars
  labels:
    app: tars
    component: api
spec:
  type: ClusterIP
  selector:
    app: tars
    component: backend
  ports:
    - name: http
      protocol: TCP
      port: 80
      targetPort: 8000
